<!DOCTYPE html>
<html>
<head>
    <title>היסטוריית לחץ דם</title>
    <meta charset="UTF-8">
    <style>
        body { text-align: center; margin-top: 20px; }
        form { text-align: right; }
        input, select { margin: 5px; }
        table { margin: 20px auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 5px; }
        .highlight { background-color: yellow; } <!-- הדגשה בצהוב -->
    </style>
</head>
<body>
    <h1>היסטוריית מדידות</h1>

    <!-- טופס לבחירת משתמש ותאריכים -->
    <form id="historyForm">
        <label>מי המשתמש:</label>
        <select id="userId">
            <option value="user1">משתמש 1</option>
            <option value="user2">משתמש 2</option>
            <option value="user3">משתמש 3</option>
        </select>
        <br>
        <label>מתאריך:</label>
        <input type="date" name="startDate">
        <br>
        <label>עד תאריך:</label>
        <input type="date" name="endDate">
        <br>
        <button type="submit">הצג</button>
    </form>

    <!-- מקום להראות את התוצאות -->
    <div id="results"></div>

    <script>
        let form = document.getElementById('historyForm');

        form.addEventListener('submit', function(event) {
            event.preventDefault();

            let user = document.getElementById('userId').value;
            let startDate = document.querySelector('[name="startDate"]').value;
            let endDate = document.querySelector('[name="endDate"]').value;

            // יוצר את הכתובת עם התאריכים
            let url = '/history/' + user;
            if (startDate && endDate) {
                url += '?startDate=' + startDate + '&endDate=' + endDate;
            }

            fetch(url)
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.error) {
                    document.getElementById('results').innerHTML = data.error;
                } else {
                    // יוצר טבלה להצגת הנתונים
                    let html = '<p>ממוצע ערך גבוה: ' + data.averageSystolic.toFixed(2) + '</p>';
                    html += '<p>ממוצע ערך נמוך: ' + data.averageDiastolic.toFixed(2) + '</p>';
                    html += '<table>';
                    html += '<tr><th>תאריך</th><th>ערך גבוה</th><th>ערך נמוך</th><th>דופק</th></tr>';
                    
                    data.measurements.forEach(m => {
                        let rowClass = m.highlight ? ' class="highlight"' : '';
                        html += '<tr' + rowClass + '>';
                        html += '<td>' + new Date(m.date).toLocaleString() + '</td>';
                        html += '<td>' + m.systolic + '</td>';
                        html += '<td>' + m.diastolic + '</td>';
                        html += '<td>' + (m.pulse || '-') + '</td>';
                        html += '</tr>';
                    });
                    
                    html += '</table>';
                    document.getElementById('results').innerHTML = html;
                }
            })
            .catch(function() {
                document.getElementById('results').innerHTML = 'יש בעיה!';
            });
        });
    </script>
</body>
</html>
